#!/bin/bash

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# IPIAL - Sistema de Gestรฃo de Exames de Acesso
# Script de inicializaรงรฃo com mรบltiplas opรงรตes para Linux/Mac
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

clear

# Cores para output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

# Obter IP da mรกquina
if [[ "$OSTYPE" == "darwin"* ]]; then
    IP=$(ifconfig | grep "inet " | grep -v 127.0.0.1 | head -1 | awk '{print $2}')
else
    IP=$(hostname -I | awk '{print $1}')
fi

show_menu() {
    clear
    echo ""
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo "โ                                                                           โ"
    echo "โ         ๐ IPIAL - Sistema de Gestao de Exames de Acesso ๐              โ"
    echo "โ                                                                           โ"
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo ""
    echo ""
    echo "  Selecione uma opรงรฃo para iniciar o sistema:"
    echo ""
    echo "  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo "  โ [1] Localhost Simples                                                   โ"
    echo "  โ     โโ Servidor Web apenas (Python)                                    โ"
    echo "  โ     โโ Acesso: http://localhost:8000                                   โ"
    echo "  โ     โโ Sem sincronizaรงรฃo (ideal para testes locais)                    โ"
    echo "  โ                                                                         โ"
    echo "  โ [2] Localhost + Servidor (RECOMENDADO)                                 โ"
    echo "  โ     โโ Servidor Node.js + Servidor Web                                โ"
    echo "  โ     โโ Acesso: http://localhost:8000                                   โ"
    echo "  โ     โโ Com sincronizaรงรฃo e backup                                      โ"
    echo "  โ                                                                         โ"
    echo "  โ [3] Rede Local (Compartilhado)                                         โ"
    echo "  โ     โโ Acesso pela rede: http://$IP:8000                              โ"
    echo "  โ     โโ Colega consegue acessar pelo celular                            โ"
    echo "  โ     โโ Com sincronizaรงรฃo em tempo real                                 โ"
    echo "  โ                                                                         โ"
    echo "  โ [4] Apenas Servidor Node.js                                            โ"
    echo "  โ     โโ Apenas para API REST                                            โ"
    echo "  โ     โโ Acesso: http://localhost:3000/api                               โ"
    echo "  โ     โโ Para desenvolvedores/testes                                     โ"
    echo "  โ                                                                         โ"
    echo "  โ [5] Apenas Servidor Web                                                โ"
    echo "  โ     โโ Apenas Python                                                   โ"
    echo "  โ     โโ Sem sincronizaรงรฃo com arquivo                                   โ"
    echo "  โ     โโ Dados apenas em localStorage                                    โ"
    echo "  โ                                                                         โ"
    echo "  โ [0] Sair                                                                โ"
    echo "  โ                                                                         โ"
    echo "  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo ""
    read -p "  Escolha uma opรงรฃo (0-5): " opcao
}

# Opรงรฃo 1: Localhost Simples
localhost_simples() {
    clear
    echo ""
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo "โ              [1] Localhost Simples - Servidor Web (Python)                โ"
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo ""
    echo "  Iniciando Servidor Web (Python)..."
    echo "  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo ""
    
    sleep 2
    
    python -m http.server 8000
}

# Opรงรฃo 2: Localhost + Servidor
localhost_servidor() {
    clear
    echo ""
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo "โ       [2] Localhost + Servidor - Node.js + Python (RECOMENDADO)          โ"
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo ""
    echo "  Iniciando Servidor Node.js (Sincronizaรงรฃo)..."
    echo "  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo ""
    
    npm start &
    NODE_PID=$!
    
    sleep 3
    
    echo ""
    echo "  Iniciando Servidor Web (Python)..."
    echo "  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo ""
    
    sleep 1
    
    python -m http.server 8000 &
    PYTHON_PID=$!
    
    clear
    
    echo ""
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo "โ                    โ AMBOS SERVIDORES INICIADOS!                         โ"
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo ""
    echo ""
    echo "  ๐ SERVIDOR DE SINCRONIZAรรO (Node.js):"
    echo "     โโ http://localhost:3000"
    echo "     โโ Dados: data/ipial_data.json"
    echo ""
    echo "  ๐ SERVIDOR WEB (Python):"
    echo "     โโ http://localhost:8000"
    echo ""
    echo ""
    echo "  ๐ CREDENCIAIS PADRรO:"
    echo "     โโ Usuรกrio: admin"
    echo "     โโ Senha: admin"
    echo ""
    echo ""
    echo "  โจ RECURSOS ATIVADOS:"
    echo "     โ Sincronizaรงรฃo em tempo real"
    echo "     โ Backup em arquivo JSON"
    echo "     โ Fallback offline (localStorage)"
    echo "     โ API REST completa"
    echo ""
    echo "  ๐ก DICA:"
    echo "     โโ Use esta opรงรฃo para desenvolvimento"
    echo "     โโ Dados sincronizam automaticamente"
    echo ""
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo ""
    echo "Pressione Ctrl+C para parar os servidores"
    echo ""
    
    # Manter em execuรงรฃo
    wait
}

# Opรงรฃo 3: Rede Local
rede_local() {
    clear
    echo ""
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo "โ       [3] Rede Local (Compartilhado) - Acessรญvel pelo Celular            โ"
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo ""
    echo "  Seu endereรงo IP: $IP"
    echo ""
    echo "  Iniciando Servidor Node.js (Sincronizaรงรฃo)..."
    echo "  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo ""
    
    npm start &
    NODE_PID=$!
    
    sleep 3
    
    echo ""
    echo "  Iniciando Servidor Web (Rede Local)..."
    echo "  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo ""
    
    sleep 1
    
    python -m http.server 8000 --bind 0.0.0.0 &
    PYTHON_PID=$!
    
    sleep 2
    
    clear
    
    echo ""
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo "โ                  โ SISTEMA COMPARTILHADO ONLINE!                         โ"
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo ""
    echo ""
    echo "  ๐ SERVIDOR DE SINCRONIZAรรO (Node.js):"
    echo "     โโ http://localhost:3000"
    echo "     โโ Dados: data/ipial_data.json"
    echo ""
    echo "  ๐ SERVIDOR WEB:"
    echo "     โโ Localhost: http://localhost:8000"
    echo "     โโ Rede Local: http://$IP:8000  โโ COPIE ESTE LINK!"
    echo ""
    echo ""
    echo "  ๐ CREDENCIAIS PADRรO:"
    echo "     โโ Usuรกrio: admin"
    echo "     โโ Senha: admin"
    echo ""
    echo ""
    echo "  ๐ฏ COMO COMPARTILHAR:"
    echo "     1. Copie o link acima: http://$IP:8000"
    echo "     2. Envie para seu colega (WhatsApp, Telegram, etc)"
    echo "     3. Colega abre no celular/tablet/laptop"
    echo "     4. Faz login com admin/admin"
    echo "     5. Todos veem e compartilham os MESMOS dados!"
    echo ""
    echo "  โจ RECURSOS ATIVADOS:"
    echo "     โ Sincronizaรงรฃo em tempo real entre dispositivos"
    echo "     โ Mรบltiplos usuรกrios acessando simultaneamente"
    echo "     โ Backup em arquivo JSON"
    echo "     โ Fallback offline"
    echo ""
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo ""
    echo "Pressione Ctrl+C para parar os servidores"
    echo ""
    
    wait
}

# Opรงรฃo 4: Apenas Node.js
apenas_node() {
    clear
    echo ""
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo "โ          [4] Apenas Servidor Node.js - API REST (Desenvolvedor)          โ"
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo ""
    echo "  Iniciando apenas Servidor Node.js..."
    echo "  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo ""
    
    sleep 1
    
    npm start
}

# Opรงรฃo 5: Apenas Web
apenas_web() {
    clear
    echo ""
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo "โ             [5] Apenas Servidor Web - Python (Simples)                    โ"
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo ""
    echo "  Iniciando apenas Servidor Web..."
    echo "  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo ""
    
    sleep 1
    
    python -m http.server 8000
}

# Loop principal
while true; do
    show_menu
    
    case $opcao in
        0)
            clear
            echo ""
            echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
            echo "โ                                                                           โ"
            echo "โ              Obrigado por usar IPIAL! Atรฉ logo! ๐                        โ"
            echo "โ                                                                           โ"
            echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
            echo ""
            exit 0
            ;;
        1)
            localhost_simples
            ;;
        2)
            localhost_servidor
            ;;
        3)
            rede_local
            ;;
        4)
            apenas_node
            ;;
        5)
            apenas_web
            ;;
        *)
            clear
            echo ""
            echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
            echo "โ                         โ OPรรO INVรLIDA โ                              โ"
            echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
            echo ""
            echo "  Digite um nรบmero entre 0 e 5."
            echo ""
            read -p "  Pressione ENTER para continuar..."
            ;;
    esac
done
